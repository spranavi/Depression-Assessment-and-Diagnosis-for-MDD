<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>DSM-5 (v1)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation/></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider/></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. Demographic Information">
		<table class="baseline-aligned">
			<tr>
				<td>Name:</td>
				<td><lookup class="value" expression="patient.personName"/></td>
			</tr>
                        <tr>
				<td>PatientID:</td>
				<td id="patientId"><lookup class="value" expression="patient.patientId"/></td>
			</tr>
			<tr>
				<td>OpenMRS ID:</td>
				<td><lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('OpenMRS ID') ) $patId #end "/></td>
			</tr>
			<tr>
				<td>Old Identification Number:</td>
				<td><lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('Old Identification Number') ) $patId #end "/></td>
			</tr>
			<tr>
				<td>OpenEMPI ID:</td>
				<td><lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('OpenEMPI ID') ) $patId #end "/></td>
			</tr>
			<tr>
				<td>OpenMRS Identification Number:</td>
				<td><lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('OpenMRS Identification Number') ) $patId #end "/></td>
			</tr>
			<tr>
				<td>Gender:</td>
				<td><lookup class="value" expression="patient.gender"/></td>
			</tr>
			<tr>
				<td>Birthdate:</td>
				<td>
					<lookup class="value" complexExpression="#if( \$patient.birthdateEstimated ) ~#end"/> <lookup class="value" expression="patient.birthdate"/>
					(Age: <lookup class="value" expression="patient.age"/>)
				</td>
			</tr>
			<tr>
				<td>Birthplace:</td>
				<td><lookup class="value" expression="personAttributes.get('Birthplace')"/></td>
			</tr>
			<tr>
				<td>Citizenship:</td>
				<td><lookup class="value" expression="personAttributes.get('Citizenship')"/></td>
			</tr>
			<tr>
				<td>Civil Status:</td>
				<td><lookup class="value" expression="personAttributes.get('Civil Status').name.name"/></td>
			</tr>
			<tr>
				<td>Health Center:</td>
				<td><lookup class="value" expression="personAttributes.get('Health Center')"/></td>
			</tr>
			<tr>
				<td>Health District:</td>
				<td><lookup class="value" expression="personAttributes.get('Health District')"/></td>
			</tr>
			<tr>
				<td>Mother's Name:</td>
				<td><lookup class="value" expression="personAttributes.get('Mothers Name')"/></td>
			</tr>
			<tr>
				<td>Race:</td>
				<td><lookup class="value" expression="personAttributes.get('Race')"/></td>
			</tr>
			<tr>
				<td>Telephone Number:</td>
				<td><lookup class="value" expression="personAttributes.get('Telephone Number')"/></td>
			</tr>
			<tr>
				<td>Unknown patient:</td>
				<td><lookup class="value" expression="personAttributes.get('Unknown patient')"/></td>
			</tr>
			<tr>
				<td>Test Patient:</td>
				<td><lookup class="value" expression="personAttributes.get('Test Patient')"/></td>
			</tr>
		</table>
	</section>

    <section headerLabel="3.DSM-5">
        <table class="baseline-aligned">
            <tr>
                <td>Little interest or pleasure in doing things:</td>
                <td><obs conceptId= "165179"  id="q1" answerConceptIds="165296,165297,165298,165299" answerLabels="0 - Not at all, 1 - Several Days, 2 - More than half the days, 3 - Nearly every day" /></td>
            </tr>
            <tr>
                <td>Feeling down, depressed, or hopeless:</td>
                <td><obs conceptId= "165180"  id="q2" answerConceptIds="165296,165297,165298,165299" answerLabels="0 - Not at all, 1 - Several Days, 2 - More than half the days, 3 - Nearly every day" /></td>
            </tr>
            <tr>
                <td>Trouble falling or staying asleep, or sleeping too much:</td>
                <td><obs conceptId= "165181"  id="q3" answerConceptIds="165296,165297,165298,165299" answerLabels="0 - Not at all, 1 - Several Days, 2 - More than half the days, 3 - Nearly every day" /></td>
            </tr>
            <tr>
                <td>Feeling tired or having little energy:</td>
                <td><obs conceptId= "165182"  id="q4" answerConceptIds="165296,165297,165298,165299" answerLabels="0 - Not at all, 1 - Several Days, 2 - More than half the days, 3 - Nearly every day" /></td>
            </tr>
            <tr>
                <td>Poor appetite or overeating:</td>
                <td><obs conceptId= "165183"  id="q5" answerConceptIds="165296,165297,165298,165299" answerLabels="0 - Not at all, 1 - Several Days, 2 - More than half the days, 3 - Nearly every day" /></td>
            </tr>
            <tr>
                <td>Feeling bad about yourself—or that you are a failure or have let yourself or your family down:</td>
                <td><obs conceptId= "165184"  id="q6" answerConceptIds="165296,165297,165298,165299" answerLabels="0 - Not at all, 1 - Several Days, 2 - More than half the days, 3 - Nearly every day" /></td>
            </tr>
            <tr>
                <td>Trouble concentrating on things, such as reading the newspaper or watching television:</td>
                <td><obs conceptId= "165185"  id="q7" answerConceptIds="165296,165297,165298,165299" answerLabels="0 - Not at all, 1 - Several Days, 2 - More than half the days, 3 - Nearly every day" /></td>
            </tr>
            <tr>
                <td>Moving or speaking so slowly that other people could have noticed? Or the opposite—being so fidgety or restless that you have been moving around a lot more than usual:</td>
                <td><obs conceptId= "165186"  id="q8" answerConceptIds="165296,165297,165298,165299" answerLabels="0 - Not at all, 1 - Several Days, 2 - More than half the days, 3 - Nearly every day" /></td>
            </tr>
            <tr>
                <td>Thoughts that you would be better off dead or of hurting yourself in some way:</td>
                <td><obs conceptId= "165187"  id="q9" answerConceptIds="165296,165297,165298,165299" answerLabels="0 - Not at all, 1 - Several Days, 2 - More than half the days, 3 - Nearly every day" /></td>
            </tr>
            <tr>
                <td>DSM-5 Score:</td>
                <td><obs conceptId= "165266" id="dsm5score" readonly="readonly"/></td>
            </tr>
            <tr>
                <td>DSM-5 Diagnosis:</td>
                <td><obs conceptId= "165301" id="dsm5diagnosis" readonly="readonly"/></td>
            </tr>
            
        </table>
    </section>
    <button type="submit" id="dsm5submit">Enter</button>
    <script type="text/javascript">
		beforeSubmit.push(function() {
                        var pname = getValue('patientname.value');
			var q1 = getValue('q1.value');
			var q2 = getValue('q2.value');
			var q3 = getValue('q3.value');
			var q4 = getValue('q4.value');
			var q5 = getValue('q5.value');
			var q6 = getValue('q6.value');
			var q7 = getValue('q7.value');
			var q8 = getValue('q8.value');
			var q9 = getValue('q9.value');
			var responseCount=0;
			var score=0;
			if (q1 == null || q1 == '') {
				responseCount+=1;
			} else{
			   score+=q1-165296;
			}
			if (q2 == null || q2 == '') {
				responseCount+=1;
			} else{
			   score+=q2-165296;
			}
			if (q3 == null || q3 == '') {
				responseCount+=1;
			} else{
			   score+=q3-165296;
			}
			if (q4 == null || q4 == '') {
				responseCount+=1;
			} else{
			   score+=q4-165296;
			}
			if (q5 == null || q5 == '') {
				responseCount+=1;
			} else{
			   score+=q5-165296;
			}
			if (q6 == null || q6 == '') {
				responseCount+=1;
			} else{
			   score+=q6-165296;
			}
			if (q7 == null || q7 == '') {
				responseCount+=1;
			} else{
			   score+=q7-165296;
			}
			if (q8 == null || q8 == '') {
				responseCount+=1;
			} else{
				score+=q8-165296;
			}
			if (q9 == null || q9 == '') {
				responseCount+=1;
			} else{
				score+=q9-165296;
			}
			if (responseCount>2){
				window.alert('Three or more responses missing');
				return false; 
			}
			else{
				score= Math.round(9*score/(9-responseCount));
			}
			
                        var diagnosis = "";
			if (4>=score){
				window.alert('The DSM-5 Score is ' + score + '. No Depression');
                                diagnosis = 'No Depression';
			}
			else if (9>=score){
				window.alert('The DSM-5 Score is ' + score + '. Mild Depression');
                                diagnosis = 'Mild Depression';
			}
		        else if (14>=score){
				window.alert('The DSM-5 Score is ' + score + '. Moderate Depression');
                                diagnosis = 'Moderate Depression';
			}
		        else if (19>=score){
				window.alert('The DSM-5 Score is ' + score + '. Moderately Severe Depression');
                                diagnosis = 'Moderately Severe Depression';
			}
		        else{
				window.alert('The DSM-5 Score is ' + score + '. Severe Depression');
                                diagnosis = 'Severe Depression';
			}
			setValue('dsm5score.value', score);
                        setValue('dsm5diagnosis.value', diagnosis);                        			

			if (4>=score) {
			      return true;
			}  else {
                              var patientId = document.getElementById('patientId').children[0].innerText; 
                             
                              document.forms["htmlform"].submit();
			      window.location = "enterHtmlFormWithStandardUi.page?formUuid=d960ea5e-c5ce-48cd-bd7c-3a785edeafba&amp;patientId="+patientId+"&amp;refappui=true&amp;dsm5score="+score+"&amp;dsm5diagnosis="+diagnosis+"&amp;returnUrl=";
			}
			
			
		});

</script>


<!-- END OF FORM

Simple examples to copy-and-paste. Full reference at http://wiki.openmrs.org/x/kg8z

SECTION
	<section headerLabel="\#. Title">
		Content
	</section>

NUMERIC OBSERVATION
	<obs conceptId="id-of-numeric-concept" labelText="Label before"/>

DATE OBSERVATION
	<obs conceptId="id-of-date-concept" labelText="Label before"/>

CODED OBSERVATION
(as a dropdown)
	<obs conceptId="id-of-coded-concept" labelText="Label before"/>
(as radio buttons)
	<obs conceptId="id-of-coded-concept" labelText="Label before" style="radio"/>
(as an autocomplete)
	<obs conceptId="id-of-coded-concept" labelText="Label before" style="autocomplete" answerClasses="Diagnosis"/>
(as a checkbox for a specific answer)
	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptId="id-of-answer-concept" answerLabel="label for answer"/>
(as a dropdown with specific choices)
	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptIds="concept-id-1,concept-id-2,concept-id-3" answerLabels="Label 1,Label 2, Label 3"/>


FREE TEXT OBSERVATION
(as a normal text field)
	<obs conceptId="id-of-text-concept" labelText="Label before"/>
(as a textarea)
	<obs conceptId="id-of-text-concept" labelText="Label before" rows="4" cols="80"/>
-->
</htmlform>