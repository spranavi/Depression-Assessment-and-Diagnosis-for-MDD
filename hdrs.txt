<htmlform onload="dsm5pop()">
  <!-- Autogenerated example form  (template from 01-Nov-2010 -->
  <macros>
    paperFormId = (Fill this in)
    headerColor =#009d8e
    fontOnHeaderColor = white
  </macros>

  <style>
    .section {
      border: 1px solid $headerColor;
      padding: 2px;
      text-align: left;
      margin-bottom: 1em;
    }

    .sectionHeader {
      background-color: $headerColor;
      color: $fontOnHeaderColor;
      display: block;
      padding: 2px;
      font-weight: bold;
    }

    table.baseline-aligned td {
      vertical-align: baseline;
    }
  </style>

  <span style="float:right">Paper Form ID: $paperFormId</span>
  <h2>Hamilton Depression Rating Scale (HDRS) (v1)</h2>

  <section headerLabel="1. Encounter Details">
    <table class="baseline-aligned">
      <tr>
        <td>Date:</td>
        <td>
          <encounterDate default="today" />
        </td>
      </tr>
      <tr>
        <td>Location:</td>
        <td>
          <encounterLocation />
        </td>
      </tr>
      <tr>
        <td>Provider:</td>
        <td>
          <encounterProvider />
        </td>
      </tr>
    </table>
  </section>

  <section headerLabel="2. Demographic Information">
    <table class="baseline-aligned">
      <tr>
        <td>Name:</td>
        <td>
          <lookup class="value" expression="patient.personName" />
        </td>
      </tr>
      <tr>
        <td>OpenMRS ID:</td>
        <td>
          <lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('OpenMRS ID') ) $patId #end " />
        </td>
      </tr>
      <tr>
        <td>Old Identification Number:</td>
        <td>
          <lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('Old Identification Number') ) $patId #end " />
        </td>
      </tr>
      <tr>
        <td>OpenEMPI ID:</td>
        <td>
          <lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('OpenEMPI ID') ) $patId #end " />
        </td>
      </tr>
      <tr>
        <td>OpenMRS Identification Number:</td>
        <td>
          <lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('OpenMRS Identification Number') ) $patId #end " />
        </td>
      </tr>
      <tr>
        <td>Gender:</td>
        <td>
          <lookup class="value" expression="patient.gender" />
        </td>
      </tr>
      <tr>
        <td>Birthdate:</td>
        <td>
          <lookup class="value" complexExpression="#if( \$patient.birthdateEstimated ) ~#end" />
          <lookup class="value" expression="patient.birthdate" />
          (Age:
          <lookup class="value" expression="patient.age" />)
        </td>
      </tr>
      <tr>
        <td>Birthplace:</td>
        <td>
          <lookup class="value" expression="personAttributes.get('Birthplace')" />
        </td>
      </tr>
      <tr>
        <td>Citizenship:</td>
        <td>
          <lookup class="value" expression="personAttributes.get('Citizenship')" />
        </td>
      </tr>
      <tr>
        <td>Civil Status:</td>
        <td>
          <lookup class="value" expression="personAttributes.get('Civil Status').name.name" />
        </td>
      </tr>
      <tr>
        <td>Health Center:</td>
        <td>
          <lookup class="value" expression="personAttributes.get('Health Center')" />
        </td>
      </tr>
      <tr>
        <td>Health District:</td>
        <td>
          <lookup class="value" expression="personAttributes.get('Health District')" />
        </td>
      </tr>
      <tr>
        <td>Mother's Name:</td>
        <td>
          <lookup class="value" expression="personAttributes.get('Mothers Name')" />
        </td>
      </tr>
      <tr>
        <td>Race:</td>
        <td>
          <lookup class="value" expression="personAttributes.get('Race')" />
        </td>
      </tr>
      <tr>
        <td>Telephone Number:</td>
        <td>
          <lookup class="value" expression="personAttributes.get('Telephone Number')" />
        </td>
      </tr>
      <tr>
        <td>Unknown patient:</td>
        <td>
          <lookup class="value" expression="personAttributes.get('Unknown patient')" />
        </td>
      </tr>
      <tr>
        <td>Test Patient:</td>
        <td>
          <lookup class="value" expression="personAttributes.get('Test Patient')" />
        </td>
      </tr>

      <tr id="sec2dsm5score">
        <td>DSM-5 Score:</td>
        <td>
          <obs conceptId="165266" id="dsm5score_field" readonly="readonly" />
        </td>
      </tr>
      <tr id="sec2dsm5dia">
        <td>DSM-5 Diagnosis:</td>
        <td>
          <obs conceptId="165301" id="dsm5diagnosis_field" readonly="readonly" />
        </td>
      </tr>
    </table>
  </section>
  <section headerLabel="3. HDRS [Instructions: for each item select the one 'cue' which best characterizes the patient. Be sure to record the answers in the appropriate spaces (positions 0 through 4).]">
    <table class="baseline-aligned">
      <tr>
        <td>DEPRESSED MOOD (sadness, hopeless, helpless, worthless)</td>
        <td>
          <obs conceptId="165193" id="q1" answerConceptIds="165296,165297,165298,165299,165300" answerLabels="0-Absent, 1-These feeling states indicate only on questioning, 2-These feeling states spontaneously reported verbally, 3-Communicates feeling states non-verbally, 4-Patient reports virtually only these feeling states in his/her spontaneous verbal and non-verbal communication" />
        </td>
      </tr>
      <tr>
        <td>FEELINGS OF GUILT</td>
        <td>
          <obs conceptId="165198" id="q2" answerConceptIds="165296,165297,165298,165299,165300" answerLabels="0-Absent, 1-Self reproach. Feels he/she has let people down, 2-Ideas of guilt or rumination over past errors or sinful deeds, 3-Present illness is a punishment. Delusions of guilt, 4-Hears accusatory or denunciatory voices and/or experiences threatening visual hallucinations" />
        </td>
      </tr>
      <tr>
        <td>SUICIDE</td>
        <td>
          <obs conceptId="165203" id="q3" answerConceptIds="165296,165297,165298,165299,165300" answerLabels="0-Absent, 1-Feels life is not worth living, 2-Wishes he/she were dead or any thoughts of possible death to self, 3-Ideas or gestures of suicide, 4-Attempts at suicide (any serious attempt rate 4)" />
        </td>
      </tr>
      <tr>
        <td>INSOMNIA:EARLY IN THE NIGHT</td>
        <td>
          <obs conceptId="165207" id="q4" answerConceptIds="165296,165297,165298" answerLabels="0-No difficulty falling asleep, 1-Complains of occasional difficulty falling asleep, 2-Complains of nightly difficulty falling asleep" />
        </td>
      </tr>
      <tr>
        <td>INSOMNIA:MIDDLE OF THE NIGHT</td>
        <td>
          <obs conceptId="165211" id="q5" answerConceptIds="165296,165297,165298" answerLabels="0-No difficulty, 1-Patient complains of being restless and disturbed during the night, 2-Waking during the night – any getting out of bed rates
2 (except for purposes of voiding)" />
        </td>
      </tr>
      <tr>
        <td>INSOMNIA: EARLY HOURS OF THE MORNING</td>
        <td>
          <obs conceptId="165214" id="q6" answerConceptIds="165296,165297,165298" answerLabels="0-No difficulty, 1-Waking in early hours of the morning but goes back to sleep, 2-Unable to fall asleep again if he/she gets out of bed" />
        </td>
      </tr>
      <tr>
        <td>WORK AND ACTIVITIES</td>
        <td>
          <obs conceptId="165219" id="q7" answerConceptIds="165296,165297,165298,165299,165300" answerLabels="0-No difficulty, 1-Thoughts and feelings of incapacity (fatigue or weakness related to activities work or hobbies), 2-Loss of interest in activity hobbies or work – either directly reported by the patient or indirect in listlessness indecision and vacillation (feels he/she has to push self to work or activities), 3-Decrease in actual time spent in activities or decrease in productivity. Rate 3 if the patient does not spend at least three hours a day in activities (job or hobbies) excluding routine chores, 4-Stopped working because of present illness. Rate 4 if patient engages in no activities except routine chores or if patient fails to perform routine chores unassisted" />
        </td>
      </tr>
      <tr>
        <td>RETARDATION (slowness of thought and speech, impaired ability to concentrate, decreased motor activity)</td>
        <td>
          <obs conceptId="165225" id="q8" answerConceptIds="165296,165297,165298,165299,165300" answerLabels="0-Normal speech and thought, 1-Slight retardation during the interview, 2-Obvious retardation during the interview, 3-Interview difficult, 4-Complete stupor" />
        </td>
      </tr>
      <tr>
        <td>AGITATION</td>
        <td>
          <obs conceptId="165231" id="q9" answerConceptIds="165296,165297,165298,165299,165300" answerLabels="0-None, 1-Fidgetiness, 2-Playing with hands hair etc, 3-Moving about. Can’t sit still, 4-Hand wringing nail biting hair-pulling, biting of lips" />
        </td>
      </tr>
      <tr>
        <td>ANXIETY PSYCHIC</td>
        <td>
          <obs conceptId="165236" id="q10" answerConceptIds="165296,165297,165298,165299,165300" answerLabels="0-No difficulty, 1-Subjective tension and irritability, 2-Worrying about minor matters, 3-Apprehensive attitude apparent in face or speech, 4-Fears expressed without questioning" />
        </td>
      </tr>
      <tr>
        <td>ANXIETY SOMATIC (physiological concomitants of anxiety)</td>
        <td>
          <obs conceptId="165238" id="q11" answerConceptIds="165296,165297,165298,165299,165300" answerLabels="0-Absent, 1-Mild, 2-Moderate, 3-Severe, 4-Incapacitating" />
        </td>
      </tr>
      <tr>
        <td>SOMATIC SYMPTOMS GASTRO-INTESTINAL</td>
        <td>
          <obs conceptId="165241" id="q12" answerConceptIds="165296,165297,165298" answerLabels="0-None, 1-Loss of appetite but eating without staff encouragement. Heavy feelings in abdomen, 2-Difficulty eating without staff urging. Requests or requires laxatives or medication for bowels or medication for gastro-intestinal symptoms" />
        </td>
      </tr>
      <tr>
        <td>GENERAL SOMATIC SYMPTOMS</td>
        <td>
          <obs conceptId="165244" id="q13" answerConceptIds="165296,165297,165298" answerLabels="0-None, 1-Heaviness in limbs back or head. Backaches headaches muscle aches. Loss of energy and fatigability, 2-Any clear-cut symptom rates 2" />
        </td>
      </tr>
      <tr>
        <td>GENITAL SYMPTOMS (symptoms such as loss of libido, menstrual disturbances)</td>
        <td>
          <obs conceptId="165245" id="q14" answerConceptIds="165296,165297,165298" answerLabels="0-Absent, 1-Mild, 2-Severe" />
        </td>
      </tr>
      <tr>
        <td>HYPOCHONDRIASIS </td>
        <td>
          <obs conceptId="165265" id="q15" answerConceptIds="165296,165297,165298,165299,165300" answerLabels="0-Not present, 1-Self-absorption (bodily), 2-Preoccupation with health, 3-Frequent complaints requests for help etc, 4-Hypochondriacal delusions" />
        </td>
      </tr>
      <tr>
        <td>LOSS OF WEIGHT</td>
        <td>
          <obs conceptId="165259" id="q16" answerConceptIds="165296,165297,165298,165299" answerLabels="0-Less than 1 lb weight loss in week, 1-Greater than 1 lb weight loss in week, 2-Greater than 2 lb weight loss in week, 3-Not assessed" />
        </td>
      </tr>

      <tr>
        <td>INSIGHT</td>
        <td>
          <obs conceptId="165264" id="q17" answerConceptIds="165296,165297,165298" answerLabels="0-Acknowledges being depressed and ill, 1-Acknowledges illness but attributes cause to bad food climate overwork virus need for rest etc, 2-Denies being ill at all" />
        </td>
      </tr>

    </table>
  </section>

  <button type="button" onclick="calculatehdrs()">Calculate HDRS</button>

  <section headerLabel="HDRS Score and Diagnosis">
    <table>
      <tr>
        <td>HDRS-Total Score</td>
        <td>
          <obs conceptId="165268" id="HDRSTotalScore" readonly="readonly" />
        </td>
      </tr>
      <tr>
        <td>HDRS Diagnosis</td>
        <td>
          <obs conceptId="165305" id="HDRSDiagnosis" readonly="readonly" />
        </td>
      </tr>
    </table>
  </section>

  <section headerLabel="Abuse">
    <table class="baseline-aligned">
      <tr style="display:none" id="substanceabuse">
        <td>Substance Abuse:</td>
        <td>
          <obs conceptId="165273" id="sub_abuse" answeconceptIds="1065, 1066" answerLabels="Yes, No" style="radio" />

        </td>
      </tr>
    </table>
  </section>
  <section headerLabel="EBPP">
    <table class="colapse">
      <tr style="display:none" id="ebpp1">
        <td>Have you considered EBPP elements in decision making:</td>
        <td>
          <obs conceptId="165276" id="ebpp1_1" answeconceptIds="1065, 1066" answerLabels="Yes, No" style="radio" />
        </td>
      </tr>
      <tr style="display:none" id="ebpp2">
        <td>Type of EBPP elements considered in decision making: </td>
        <td>
          <repeat with="['165302','Best available research'],['165303','Clinical expertise'],['165304','Patient's characteristics values and context']">
            <obs conceptId="165315" answerConceptId=" {0} " answerLabel=" {1} " style="checkbox" />
          </repeat>
        </td>
      </tr>
    </table>
  </section>
  <section headerLabel="Treatment" class="sectionColapse">
    <table class="colapse">
      <tr style="display:none" id="trec">
        <td>Treatment Recommendations: </td>
        <td>
          <repeat with="['165313','Pharmacotherapy'],['165307','Behavioural Therapy'],['165309','Cognitive behavioural therapy'],['165310','Interpersonal therapy'],['165311','Psychodynamic therapy'],['165312','Supportive therapy']">
            <obs conceptId="165314" answerConceptId=" {0} " answerLabel=" {1} " style="checkbox" />
          </repeat>
        </td>
      </tr>
    </table>
  </section>
  <section headerLabel="Consent and Treatment initiation" class="sectionColapse">
    <table class="colapse">
      <tr style="display:none" id="infoconsent">
        <td>Informed consent:</td>
        <td>
          <obs conceptId="165277" answerconceptIds="1065,1066" answerLabels="Yes,No" style="radio" />
        </td>
      </tr>
      <tr style="display:none" id="treinit">
        <td>Treatment Initiated:</td>
        <td>
          <obs conceptId="165282" answerconceptIds="1065,1066" answerLabels="Yes,No" style="radio" />
        </td>
      </tr>
    </table>
  </section>

  <submit />

  <script type="text/javascript">
    function calculatehdrs() {
      var q1 = getValue('q1.value');
      var q2 = getValue('q2.value');
      var q3 = getValue('q3.value');
      var q4 = getValue('q4.value');
      var q5 = getValue('q5.value');
      var q6 = getValue('q6.value');
      var q7 = getValue('q7.value');
      var q8 = getValue('q8.value');
      var q9 = getValue('q9.value');
      var q10 = getValue('q10.value');
      var q11 = getValue('q11.value');
      var q12 = getValue('q12.value');
      var q13 = getValue('q13.value');
      var q14 = getValue('q14.value');
      var q15 = getValue('q15.value');
      var q16 = getValue('q16.value');
      var q17 = getValue('q17.value');
      var responseCount = 0;
      var score = 0;
      if (q1 == null || q1 == '') {
        responseCount += 1;
      } else {
        score += q1 - 165296;
      }
      if (q2 == null || q2 == '') {
        responseCount += 1;
      } else {
        score += q2 - 165296;
      }
      if (q3 == null || q3 == '') {
        responseCount += 1;
      } else {
        score += q3 - 165296;
      }
      if (q4 == null || q4 == '') {
        responseCount += 1;
      } else {
        score += q4 - 165296;
      }
      if (q5 == null || q5 == '') {
        responseCount += 1;
      } else {
        score += q5 - 165296;
      }
      if (q6 == null || q6 == '') {
        responseCount += 1;
      } else {
        score += q6 - 165296;
      }
      if (q7 == null || q7 == '') {
        responseCount += 1;
      } else {
        score += q7 - 165296;
      }
      if (q8 == null || q8 == '') {
        responseCount += 1;
      } else {
        score += q8 - 165296;
      }
      if (q9 == null || q9 == '') {
        responseCount += 1;
      } else {
        score += q9 - 165296;
      }
      if (q10 == null || q10 == '') {
        responseCount += 1;
      } else {
        score += q10 - 165296;
      }
      if (q11 == null || q11 == '') {
        responseCount += 1;
      } else {
        score += q11 - 165296;
      }
      if (q12 == null || q12 == '') {
        responseCount += 1;
      } else {
        score += q12 - 165296;
      }
      if (q13 == null || q13 == '') {
        responseCount += 1;
      } else {
        score += q13 - 165296;
      }
      if (q14 == null || q14 == '') {
        responseCount += 1;
      } else {
        score += q14 - 165296;
      }
      if (q15 == null || q15 == '') {
        responseCount += 1;
      } else {
        score += q15 - 165296;
      }
      if (q16 == null || q16 == '') {
        responseCount += 1;
      } else {
        score += q16 - 165296;
      }
      if (q17 == null || q17 == '') {
        responseCount += 1;
      } else {
        score += q17 - 165296;
      }
      if (responseCount > 1) {
        window.alert('There are missing responses');
        return false;
      }

      var diagnosis = '';
      if (7 >= score) {
        window.alert('The HDRS Total Score is ' + score + '. No Depression');
        diagnosis = 'No Depression';
        document.getElementById('substanceabuse').style.display = 'none';
      } else if (8 >= score) {
        window.alert('The HDRS Total Score is ' + score + '. Mild Depression');
        diagnosis = 'Mild Depression';
        document.getElementById('substanceabuse').style.display = '';
      } else if (17 >= score) {
        window.alert('The HDRS Total Score is ' + score + '. Moderate Depression');
        diagnosis = 'Moderate Depression';
        document.getElementById('substanceabuse').style.display = '';
      } else {
        window.alert('The HDRS Total Score is ' + score + '. Severe Depression');
        diagnosis = 'Severe Depression';
        document.getElementById('substanceabuse').style.display = '';
      }
      setValue('HDRSTotalScore.value', score);
      setValue('HDRSDiagnosis.value', diagnosis);

      
    }

    beforeSubmit.push(function() {
      return true;
    });

    function computeChange() {
      var hdrs_score = document.getElementById('w46').value;
      if (hdrs_score>7) {
        document.getElementById('substanceabuse').style.display = '';
      } else {
        document.getElementById('substanceabuse').style.display = 'none';
        document.getElementById('w50_1').checked = false;
      }
      var sub_abuse_no = document.getElementById('w50_1').checked;
      var sub_abuse_yes = document.getElementById('w50_0').checked;
      if (sub_abuse_no) {
        document.getElementById('ebpp1').style.display = '';
      } else if (!sub_abuse_no || sub_abuse_yes) {
        document.getElementById('ebpp1').style.display = 'none';
        document.getElementById('w52_0').checked = false;
      }
      var ebpp1_yes = document.getElementById('w52_0').checked;
      var ebpp1_no = document.getElementById('w52_1').checked;
      if (ebpp1_yes) {
        document.getElementById('ebpp2').style.display = '';
      } else if (!ebpp1_yes || ebpp1_no) {
        document.getElementById('ebpp2').style.display = 'none';
        document.getElementById('w54').checked = false;
        document.getElementById('w56').checked = false;
        document.getElementById('w58').checked = false;
      }
      var ebpp2_0 = document.getElementById('w54').checked;
      var ebpp2_1 = document.getElementById('w56').checked;
      var ebpp2_2 = document.getElementById('w58').checked;
      if (ebpp2_0 &amp;&amp; ebpp2_1 &amp;&amp; ebpp2_2) {
        document.getElementById('trec').style.display = '';
      } else {
        document.getElementById('trec').style.display = 'none';
        document.getElementById('w60').checked = false;
        document.getElementById('w62').checked = false;
        document.getElementById('w64').checked = false;
        document.getElementById('w66').checked = false;
        document.getElementById('w68').checked = false;
        document.getElementById('w70').checked = false;
      }
      var trec_0 = document.getElementById('w60').checked;
      var trec_1 = document.getElementById('w62').checked;
      var trec_2 = document.getElementById('w64').checked;
      var trec_3 = document.getElementById('w66').checked;
      var trec_4 = document.getElementById('w68').checked;
      var trec_5 = document.getElementById('w70').checked;
      if (trec_0 || trec_1 || trec_2 || trec_3 || trec_4 || trec_5) {
        document.getElementById('infoconsent').style.display = '';
      } else {
        document.getElementById('infoconsent').style.display = 'none';
        document.getElementById('w72_0').checked = false;
      }
      var infoconsent_yes = document.getElementById('w72_0').checked;
      var infoconsent_no = document.getElementById('w72_1').checked;
      if (infoconsent_yes) {
        document.getElementById('treinit').style.display = '';
      } else if (!infoconsent_yes || infoconsent_no) {
        document.getElementById('w74_0').checked = false;
        document.getElementById('treinit').style.display = 'none';
      }
    }


    if (jQuery) {
      jQuery(function() {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const dsm5score = urlParams.get('dsm5score');
        const dsm5diagnosis = urlParams.get('dsm5diagnosis');
        if (dsm5score==null) {
            document.getElementById('sec2dsm5score').style.display = 'none';
            document.getElementById('sec2dsm5dia').style.display = 'none';
        }

        setValue('dsm5score_field.value', dsm5score);
        setValue('dsm5diagnosis_field.value', dsm5diagnosis);

      });

      jq(function() {
        computeChange();
      });

      $('input[type="radio"]').click(function() {
        computeChange();
      });

      $('input[type="checkbox"]').click(function() {
        computeChange();
      });
    }
  </script>

  <!-- END OF FORM

Simple examples to copy-and-paste. Full reference at http://wiki.openmrs.org/x/kg8z

SECTION
	<section headerLabel="\#. Title">
		Content
	</section>

NUMERIC OBSERVATION
	<obs conceptId="id-of-numeric-concept" labelText="Label before"/>

DATE OBSERVATION
	<obs conceptId="id-of-date-concept" labelText="Label before"/>

CODED OBSERVATION
(as a dropdown)
	<obs conceptId="id-of-coded-concept" labelText="Label before"/>
(as radio buttons)
	<obs conceptId="id-of-coded-concept" labelText="Label before" style="radio"/>
(as an autocomplete)
	<obs conceptId="id-of-coded-concept" labelText="Label before" style="autocomplete" answerClasses="Diagnosis"/>
(as a checkbox for a specific answer)
	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptId="id-of-answer-concept" answerLabel="label for answer"/>
(as a dropdown with specific choices)
	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptIds="concept-id-1,concept-id-2,concept-id-3" answerLabels="Label 1,Label 2, Label 3"/>


FREE TEXT OBSERVATION
(as a normal text field)
	<obs conceptId="id-of-text-concept" labelText="Label before"/>
(as a textarea)
	<obs conceptId="id-of-text-concept" labelText="Label before" rows="4" cols="80"/>
-->
</htmlform>